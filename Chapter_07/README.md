# Chapter 07: 웹 스크래핑을 활용한 주식 데이터 수집 및 분석

## 개요

이 챕터는 **"혼자 공부하는 파이썬"** 책의 내용을 기반으로, Playwright를 사용하여 네이버 금융에서 코스피 시가총액 데이터를 웹 스크래핑하고, 수집한 데이터를 분석하여 시각화하는 프로젝트입니다.

## 학습 내용

- **Playwright 기초**: 브라우저 자동화 및 웹 페이지 상호작용
- **웹 스크래핑**: 동적 웹 페이지에서 테이블 데이터 추출
- **데이터 전처리**: JSON 및 CSV 형식으로 데이터 저장 및 정제
- **데이터 분석**: 시가총액 기반 상위 종목 분석 및 누적 비율 계산
- **데이터 시각화**: Plotly를 활용한 트리맵(Treemap) 시각화

## 프로젝트 구조

```
Chapter_07/
├── output/              # 결과 파일 저장 디렉터리
│   ├── step_1_3.json   # 코스피 시가총액 테이블 데이터 (JSON)
│   ├── step_1_4.csv    # 정제된 코스피 시가총액 데이터 (CSV)
│   ├── step_2_2.csv    # 전체 페이지 수집 데이터 (CSV)
│   ├── step_3_1.csv    # 상위 50% 시가총액 종목 (CSV)
│   └── step_3_2.png    # 트리맵 시각화 이미지
├── step_1_1.py         # 출력 디렉터리 생성
├── step_1_2.py         # Playwright 브라우저 실행 및 기본 설정
├── step_1_3.py         # 네이버 금융에서 코스피 시가총액 테이블 데이터 수집
├── step_1_4.py         # 수집한 데이터를 CSV로 변환 및 정제
├── step_2_1.py         # 전체 페이지 수 확인
├── step_2_2.py         # 모든 페이지의 데이터 수집
├── step_3_1.py         # 상위 50% 시가총액 종목 추출 및 분석
├── step_3_2.py         # 트리맵 시각화
└── requirements.txt    # 필요한 패키지 목록
```

## 실행 순서

각 스크립트는 순차적으로 실행되어야 합니다:

1. **`step_1_1.py`**: `output` 폴더를 생성합니다.
2. **`step_1_2.py`**: Playwright 브라우저를 실행하고 네이버 금융 페이지를 엽니다.
3. **`step_1_3.py`**: 코스피 시가총액 페이지로 이동하여 테이블 데이터를 수집하고 JSON으로 저장합니다.
4. **`step_1_4.py`**: JSON 데이터를 읽어 CSV로 변환하고 데이터를 정제합니다.
5. **`step_2_1.py`**: 전체 페이지 수를 확인합니다.
6. **`step_2_2.py`**: 모든 페이지의 데이터를 수집하여 하나의 CSV 파일로 저장합니다.
7. **`step_3_1.py`**: 시가총액 기준 상위 50% 종목을 추출하고 누적 비율을 계산합니다.
8. **`step_3_2.py`**: 상위 종목들을 트리맵으로 시각화하여 PNG 이미지로 저장합니다.

## 주요 기능

### 웹 스크래핑
- Playwright를 사용한 브라우저 자동화
- 동적 웹 페이지에서 테이블 데이터 추출
- 페이지네이션 처리 및 다중 페이지 데이터 수집

### 데이터 처리
- JSON 형식으로 원본 데이터 저장
- 데이터 정제 및 CSV 변환
- 시가총액 기준 정렬 및 누적 비율 계산

### 시각화
- Plotly를 활용한 트리맵 생성
- 시가총액 비율에 따른 크기 및 색상 표현
- 고해상도 이미지 저장 (1600x900, scale=2)

## 필요 라이브러리

- `playwright`: 웹 브라우저 자동화
- `pandas`: 데이터 처리 및 분석
- `plotly`: 인터랙티브 시각화
- `kaleido`: Plotly 이미지 저장을 위한 백엔드

## 설치 방법

```bash
pip install -r requirements.txt
playwright install chromium
```

## 참고사항

- 이 프로젝트는 학습 목적으로 작성되었으며, 실제 투자 결정에 사용하지 마세요.
- 웹 스크래핑 시 해당 웹사이트의 이용약관을 준수해야 합니다.
- 네이버 금융의 페이지 구조가 변경되면 코드 수정이 필요할 수 있습니다.

